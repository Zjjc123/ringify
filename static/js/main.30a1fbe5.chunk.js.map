{"version":3,"sources":["pages/Login.js","hooks/useAuth.js","components/Album.js","pages/Dashboard.js","App.js","index.js"],"names":["Login","className","href","class","homePath","serverUrl","Album","album","console","log","url","alt","title","src","albumUrl","artist","releaseDate","spotifyApi","SpotifyWebApi","clientId","Dashboard","accessToken","code","useState","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","useEffect","axios","post","then","res","data","window","history","pushState","catch","location","interval","setInterval","clearInterval","useAuth","albums","setAlbums","newAlbums","getFollowedArtists","limit","Promise","all","body","artists","items","map","getArtistAlbums","id","forEach","dateReleased","Date","release_date","now","getTime","push","filtered","name","external_urls","spotify","images","filter","sort","a","b","URLSearchParams","search","get","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.30a1fbe5.chunk.js","sourcesContent":["import React from \"react\";\n\nconst CLIENT_ID = \"9149f32554f7425bac1191a602bb83e7\";\nconst REDIRECT_URL = \"https://zjjc123.github.io/ringify\";\nconst SCOPE = \"user-follow-read\";\n\nconst AUTH_URL =\n    \"https://accounts.spotify.com/authorize?client_id=\" +\n    CLIENT_ID +\n    \"&response_type=code&redirect_uri=\" +\n    REDIRECT_URL +\n    \"&scope=\" +\n    SCOPE;\n\nexport default function Login() {\n    return (\n        <div className=\"container mx-auto\">\n            <div className=\"flex flex-col justify-center items-center my-12 text-center\">\n                <h1 className=\"flex text-5xl text-center\">\n                    Get a collection of new releases from artists you follow\n                </h1>\n                <a\n                    className=\"bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-4 my-8 rounded\"\n                    href={AUTH_URL}\n                >\n                    Login with Spotify\n                </a>\n            </div>\n            <footer class=\"fixed bottom-0 right-0 m-2 text-sm\">\n                Jason Zhang 2021\n            </footer>\n        </div>\n    );\n}\n","import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\nconst homePath = \"/ringify\";\nconst serverUrl = \"https://ringify.herokuapp.com\";\n\nexport default function useAuth(code) {\n    const [accessToken, setAccessToken] = useState();\n    const [refreshToken, setRefreshToken] = useState();\n    const [expiresIn, setExpiresIn] = useState();\n\n    useEffect(() => {\n        axios\n            .post(serverUrl + \"/login\", {\n                code,\n            })\n            .then((res) => {\n                setAccessToken(res.data.accessToken);\n                setRefreshToken(res.data.refreshToken);\n                setExpiresIn(res.data.expiresIn);\n                window.history.pushState({}, null, homePath);\n            })\n            .catch(() => {\n                window.location = homePath;\n            });\n    }, [code]);\n\n    useEffect(() => {\n        if (!refreshToken || !expiresIn) return;\n        const interval = setInterval(() => {\n            axios\n                .post(serverUrl + \"/refresh\", {\n                    refreshToken,\n                })\n                .then((res) => {\n                    setAccessToken(res.data.accessToken);\n                    setExpiresIn(res.data.expiresIn);\n                })\n                .catch(() => {\n                    window.location = homePath;\n                });\n        }, (expiresIn - 60) * 1000);\n        return () => clearInterval(interval);\n    }, [refreshToken, expiresIn]);\n\n    return accessToken;\n}\n","import React from \"react\";\n\nexport default function Album({ album }) {\n    console.log(album.url);\n    return (\n        <a\n            className=\"w-full lg:max-w-full lg:flex my-16 shadow-md \"\n            href={album.url}\n        >\n            <img\n                className=\"lg:w-48 w-full flex-none object-cover rounded-t rounded-l overflow-hidden\"\n                alt={album.title}\n                src={album.albumUrl}\n            ></img>\n            <div className=\"lg:rounded-r p-4 flex flex-col justify-between leading-normal\">\n                <div className=\"mb-8\">\n                    <div className=\"text-gray-900 font-bold text-lg lg:text-2xl mb-2\">\n                        {album.title}\n                    </div>\n                </div>\n                <div className=\"flex items-center\">\n                    <div className=\"text-md lg:text-xl\">\n                        <p className=\"text-gray-900 leading-none\">\n                            {album.artist}\n                        </p>\n                        <p className=\"text-gray-600\">{album.releaseDate}</p>\n                    </div>\n                </div>\n            </div>\n        </a>\n    );\n}\n","import React, { useState, useEffect } from \"react\";\nimport useAuth from \"../hooks/useAuth\";\n\nimport SpotifyWebApi from \"spotify-web-api-node\";\nimport Album from \"../components/Album\";\n\nconst spotifyApi = new SpotifyWebApi({\n    clientId: \"9149f32554f7425bac1191a602bb83e7\",\n});\n\nexport default function Dashboard({ code }) {\n    const accessToken = useAuth(code);\n    const [albums, setAlbums] = useState();\n\n    useEffect(() => {\n        if (!accessToken) return;\n        spotifyApi.setAccessToken(accessToken);\n    }, [accessToken]);\n\n    useEffect(() => {\n        if (!accessToken) return;\n        var newAlbums = [];\n        spotifyApi\n            .getFollowedArtists({ limit: 50 })\n            .then((data) => {\n                // for each followed artist\n                return Promise.all(\n                    data.body.artists.items.map((artist) => {\n                        return spotifyApi\n                            .getArtistAlbums(artist.id)\n                            .then((data) => {\n                                // for each album by that artist\n                                data.body.items.forEach((album) => {\n                                    const dateReleased = new Date(\n                                        album.release_date\n                                    );\n                                    const timeDifference =\n                                        Date.now() - dateReleased.getTime();\n                                    const dayDifference =\n                                        timeDifference / (1000 * 3600 * 24);\n\n                                    if (dayDifference < 30) {\n                                        newAlbums.push(album);\n                                    }\n                                });\n                            });\n                    })\n                );\n            })\n            .then(() => {\n                const unsorted = newAlbums.map((album) => {\n                    return {\n                        artist: album.artists[0].name,\n                        title: album.name,\n                        url: album.external_urls.spotify,\n                        albumUrl: album.images[0].url,\n                        releaseDate: album.release_date,\n                    };\n                });\n                const filtered = unsorted.filter(\n                    (album) => album.artist !== \"Various Artists\"\n                );\n                setAlbums(\n                    filtered.sort(\n                        (a, b) =>\n                            new Date(b.releaseDate).getTime() -\n                            new Date(a.releaseDate).getTime()\n                    )\n                );\n            });\n    }, [accessToken]);\n\n    return (\n        <div>\n            <h1 className=\"text-center text-5xl font-bold pt-16 pb-4\">\n                New Releases\n            </h1>\n            <div className=\"justify-center h-screen w-full px-8 lg:px-48 py-3 lg:py-8\">\n                {albums ? (\n                    albums.map((album) => <Album album={album} />)\n                ) : (\n                    <div />\n                )}\n            </div>\n        </div>\n    );\n}\n","import Login from \"./pages/Login\";\nimport Dashboard from \"./pages/Dashboard\";\n\nconst code = new URLSearchParams(window.location.search).get(\"code\");\n\nfunction App() {\n    return code ? <Dashboard code={code} /> : <Login />;\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n"],"sourceRoot":""}